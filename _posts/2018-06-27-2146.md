---
ID: 2146
post_title: SAML介绍
author: forgerockcn
post_excerpt: ""
layout: post
permalink: >
  http://www.forgerockcn.com/2018/06/27/2146/
published: true
post_date: 2018-06-27 02:51:27
tags:
  - SAML
categories:
  - ForgeRock
  - IAM
---
**什么是SAML?** 

SAML(Security Assertion Markup Language)是一个基于XML的开源标准数据格式，开始于2001年。SAML主要被用于在两种类型的对象之间交换数据，而交换数据的目的则是为了实现对用户的验证和授权。在2005年，SAML2.0作为安全技术委员会（OASIS）的一个标准被提出，并得到广泛的应用。时至今日，这个标准仍然是网络安全验证和授权的重要标准之一。我们后面讲的全部是关于SAML2.0。 

**验证（Authentication）和授权（Authorization）的区别** 

验证（Authentication）的过程是证明你声称的身份确实是如你所说。 

授权（Authorization）给予你相应的对资源进行操作的权限。通常授权发生在验证之后。 

**为什么企业需要用到SAML?** 

随着企业基础设施，服务和数据的扩大，SAML提供了一种将不同的组件和模块联系起来的、安全的验证和授权的机制。SAML使得就算是那些没有在企业内部数据库中注册过的外部用户一样能够轻松便捷的登录到企业应用中并使用相应的服务。 

SAML避免了在不同web应用中使用多个密码，取而代之的则是基于token的验证机制。举个例子，用户想登录一个web应用来使用它提供的服务，通常的机制是用户先注册，然后通过用户名和密码来验证登录。这种简单的情况还是比较容易处理，但是当web应用的数量变多的时候，用户就需要在每一个应用中各注册一个账号，然后分别登录，变得很繁琐。如果使用SAML，那么只需要一个账号和密码就可以来登录到这些web应用中。不过这有一个重要的前提，那就是这些web应用已经做好了沟通，确切的说是按照SAML的协议进行了彼此绑定。在浩瀚的互联网宇宙中实现这一点是极为困难的，但是如果是在一个企业内部，或者固定的企业与企业之间，则是可能的。 

**单点登录（Single Sign-On）和单点注销（Single Sign-Out）** 

单点登录是指登录到一个系统之后，即使系统内部有多个不同的web应用，用户也不需要用到多个用户名和密码来反复登录。一次登录之后就可以实现多个web应用的无缝登录。 

单点登录是一个概念，背后实现的方法有多种，而SAML就是常被用于企业内部进行单点登录的方法。 

单点注销与单点登录的概念类似。当在系统中单点注销后，所以得应用和服务也被注销掉，用户需要重新登录来访问这些应用和服务。 

**什么是SAML提供者（SAML Provider）？** 

在SAML的语境下，提供者（provider）指一个实体，比如一台服务器，并且这个实体是来帮助用户访问他想要的服务。 

**IDP和SP** 

IDP和SP是SAML协议中的两种模块角色的类型。IDP（身份提供者，Identity Provider）提供用户的身份数据包括譬如用户名，密码，身份类型，权限范围等。SP（服务提供者，Service Provider）提供web应用和服务。 

**为什么需要将IDP和SP分开？** 

我们提到了SAML的两个主要角色IDP和SP。IDP主要用于提供用户信息作为验证和授权，而SP则是来提供服务。为什么需要把两个角色分开？一般来说web应用提供功能和服务，用户登录到该应用的时候，这个应用的内部是存有用户的信息来作为验证的。换句话说，我们可以认为SP和IDP在这种情况下是集成在一起的。然而，在多个应用的情况下，我们可以通过多个SP和一个IDP来实现单点登录。当用户需要登录的时候，各个SP通过跟IDP交互来验证用户。而SAML则提供了这个交互所需要的协议和框架。 

需要指出的是，多个IDP的情况也是可行的，只是在这种情况下，IDP和IDP之间要达成一个共识，对用户进行联邦设置（Federated Identity）。例如，用户user1在IDP1中的用户名是A，在IDP2的用户名是B。虽然是两个不同的IDP，但是实则是同一个用户。联邦用户就是将同一个用户的不同用户信息联系起来，这样在不同IDP环境下我们知道这是同一个用户。SAML框架下也可以实现这一点，只是需要更多的设置和操作。 

**SAML工作流程** 

SAML的工作流程主要可以分为两类：1. SP初始化流程（SP-initiated Flow）；2. IDP初始化流程（IDP-initiated Flow）。两者的步骤除了最开始的，其它基本相同。只是从应用的角度，两个流程还是有一定的区别，所以会区分开来。 

在我们看流程之前，除了IDP和SP，还有一个重要角色，那就是用户。用户访问应用需要用到浏览器，而浏览器在这里也起到了重要的作用，包括页面跳转重定向，发送SAML数据信息等等。虽然SAML的两个工作流程是按照IDP或者SP开始做的分类，但是其实从某种意义上来说是因为用户希望登录应用系统，才会开始这个工作流程。不管如何，我们先来看看基本流程。 

下图的工作流程以SP初始化为例。 

步骤的简单描述： 

1.  用户访问SP应用服务 
2.  SP发现用户并没有登录，于是生成一个SAML请求，包含一系列的信息。 
3.  SP通过浏览器重定向到IDP的地址，并附上SAML请求。 
4.  IDP解析请求，验证请求的有效性，然后对用户进行验证（比如用户输入用户名密码）。 
5.  IDP针对解析验证的结果生成SAML响应，通过浏览器重定向到SP端，并附上SAML响应。 
6.  SP验证SAML响应。 
7.  SP成功验证SAML响应，用户登录成功。 

<img src="http://www.forgerockcn.com/wp-content/uploads/2018/06/word-image.png" class="wp-image-2147" width="70%" />

Figure 1. SAML工作流程 

这里的步骤描述相对简化，具体的内容会在后面讲到。 

**SAML的请求信息（SAML Request）和响应信息（SAML Response）** 

SAML请求和响应的信息交换是基于XML格式的，包含四个主要的组件：配置文件（profiles）、断言（Assertion）、协议（Protocol）和绑定（Binding）。 



<img src="http://www.forgerockcn.com/wp-content/uploads/2018/06/word-image-1.png" class="wp-image-2148" />

- SAML 配置详细描述了SAML断言，协议和绑定如何结合起来 

- SAML绑定是SAML协议消息到标准消息格式和/或通信协议的映射。 

  
- SAML协议描述了如何打包SAML元素。 

- SAML断言包含安全信息或决策信息的数据包。
